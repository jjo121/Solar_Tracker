#include <xc.inc>

global status_p0p2_p1p3_l, status_p0p2_p1p3_h, status_p0p1_p2p3_l, status_p0p1_p2p3_h
global difference_p0p2_p1p3_l, difference_p0p2_p1p3_h, difference_p0p1_p2p3_l, difference_p0p1_p2p3_h
    
extrn  Photodiode_0L, Photodiode_0H,Photodiode_1L,Photodiode_1H
extrn  Photodiode_2L, Photodiode_2H,Photodiode_3L,Photodiode_3H

psect	udata_acs
	
difference_p0p2_p1p3_l:  	ds  1
difference_p0p2_p1p3_h:  	ds  1
difference_p0p1_p2p3_l:  	ds  1
difference_p0p1_p2p3_h:  	ds  1

status_p0p2_p1p3_l:		ds  1
status_p0p2_p1p3_h:		ds  1
status_p0p1_p2p3_l:	    	ds  1
status_p0p1_p2p3_h:	   	ds  1

totalp0p1H:	  	ds  1
totalp0p2H:	    	ds  1
totalp1p3H:	    	ds  1  
totalp2p3H:	    	ds  1
totalp0p1L:	    	ds  1
totalp0p2L:	    	ds  1
totalp1p3L:	    	ds  1  
totalp2p3L:	    	ds  1

psect	adc_code, class=CODE

average:
	movf	Photodiode_0H,W
	addwf	Photodiode_1H,0
	movwf	totalp0p1H
	
	movf	Photodiode_0L,W
	addwf	Photodiode_1L,0
	movwf	totalp0p1L
	
	movf	Photodiode_0H,W
	addwf	Photodiode_2H,0
	movwf	totalp0p2H
	
	movf	Photodiode_0L,W
	addwf	Photodiode_2L,0
	movwf	totalp0p2L
	
	movf	Photodiode_1H,W
	addwf	Photodiode_3H,0
	movwf	totalp1p3H
	
	movf	Photodiode_1L,W
	addwf	Photodiode_3L,0
	movwf	totalp1p3L
	
	movf	Photodiode_2H,W
	addwf	Photodiode_3H,0
	movwf	totalp2p3H
	
	movf	Photodiode_2L,W
	addwf	Photodiode_3L,0
	movwf	totalp2p3L
	return

compare_p0p2_p1p3_h:
	movf	totalp0p2H, W
	subwf	totalp1p3H, 0
	movwf	difference_p0p2_p1p3_h
	btfsc	STATUS, 0
	bra	compare_p0p2_p1p3_l
	comf	difference_p0p2_p1p3_h
	incf	difference_p0p2_p1p3_h
	movlw	0x01
	movwf	status_p0p2_p1p3_h
	bcf	STATUS, 0

compare_p0p2_p1p3_l:	
	movf	totalp0p2L, W
	subwf	totalp1p3L, 0
	movwf	difference_p0p2_p1p3_l
	btfsc	STATUS, 0
	return
	comf	difference_p0p2_p1p3_l
	incf	difference_p0p2_p1p3_l
	movlw	0x01
	movwf	status_p0p2_p1p3_l
	return

compare_p0p1_p2p3_h:
	movf	totalp0p1H, W
	subwf	totalp2p3H, 0
	movwf	difference_p0p1_p2p3_h
	btfsc	STATUS, 0
	bra	compare_p0p1_p2p3_l
	comf	difference_p0p1_p2p3_h
	incf	difference_p0p1_p2p3_h
	movlw	0x01
	movwf	status_p0p1_p2p3_h
	bcf	STATUS, 0

compare_p0p2_p1p3_l:	
	movf	totalp0p1L, W
	subwf	totalp2p3L, 0
	movwf	difference_p0p1_p2p3_l
	btfsc	STATUS, 0
	return
	comf	difference_p0p1_p2p3_l
	incf	difference_p0p1_p2p3_l
	movlw	0x01
	movwf	status_p0p1_p2p3_l
	return


